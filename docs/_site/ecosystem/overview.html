
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Apache Submarine 0.3.0 Documentation: Install</title>
    <meta name="description" content="This page will help you get started and will guide you through installing Apache Submarine and running it in the command line.">
    <meta name="author" content="The Apache Software Foundation">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- Le styles -->
    <link href="/assets/themes/submarine/bootstrap/css/bootstrap.css" rel="stylesheet">
    <link href="/assets/themes/submarine/css/style.css?body=1" rel="stylesheet" type="text/css">
    <link href="/assets/themes/submarine/css/syntax.css" rel="stylesheet"  type="text/css" media="screen" /> 
    <!-- Le fav and touch icons -->
    <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->

    <!-- Js -->
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="/assets/themes/submarine/bootstrap/js/bootstrap.min.js"></script>
    <script src="/assets/themes/submarine/js/docs.js"></script>
    <script src="/assets/themes/submarine/js/anchor.min.js"></script>
    <script src="/assets/themes/submarine/js/toc.js"></script>
    <script src="/assets/themes/submarine/js/lunr.min.js"></script>
    <script src="/assets/themes/submarine/js/search.js"></script>    

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">
  </head>

  <body>
    
        <div id="menu" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container navbar-container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <div class="navbar-brand">
            <a class="navbar-brand-main" href="http://submarine.apache.org">
              <img src="/assets/themes/submarine/img/submarine_white_logo.png" width="85"
                   style="margin-top: -2px;" alt="Apache Submarine">
              <span style="margin-left: 5px; font-size: 27px;">Submarine</span>
              <a class="navbar-brand-version" href=""
                 style="font-size: 15px; color: white;"> 0.3.0
              </a>
            </a>
          </div>
        </div>
        <nav class="navbar-collapse collapse" role="navigation">
          <ul class="nav navbar-nav">
            <li>
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">Quick Start <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li class="title"><span>Getting Started</span></li>
                <li><a href="/quickstart/index.html">Quick Start Guide</a></li>
                <li><a href="/quickstart/install.html">Install Submarine</a></li>
                <li role="separator" class="divider"></li>
                <li><a href="/quickstart/tensorflow_with_submarine.html">Tensorflow with Submarine</a></li>
                <li><a href="/quickstart/pytorch_with_submarine.html">PyTorch with Submarine</a></li>
              </ul>
            </li>

            <li>
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">Usage<b class="caret"></b></a>
              <ul class="dropdown-menu scrollable-menu">
                <li class="title"><span>Interpreter</span></li>
                <li><a href="/usage/interpreter/overview.html">Overview</a></li>
                <li><a href="/usage/interpreter/interpreter_binding_mode.html">Interpreter Binding Mode</a></li>
                <li><a href="/usage/interpreter/user_impersonation.html">User Impersonation</a></li>
                <li role="separator" class="divider"></li>
                <li class="title"><span>REST API</span></li>
                <li><a href="/usage/rest_api/submarine_server.html">Submarine Server API</a></li>
                <li><a href="/usage/rest_api/configuration.html">Configuration API</a></li>
                <li role="separator" class="divider"></li>
                <li class="title"><span>Other Features</span></li>
                <li><a href="/usage/other_features/publishing_paragraphs.html">Publishing Paragraphs</a></li>
                <li><a href="/usage/other_features/personalized_mode.html">Personalized Mode</a></li>
                <li><a href="/usage/other_features/customizing_homepage.html">Customizing Zeppelin Homepage</a></li>
              </ul>
            </li>

            <li>
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">Setup<b class="caret"></b></a>
              <ul class="dropdown-menu scrollable-menu">
                <li class="title"><span>Basics</span></li>
                <li><a href="/setup/basics/how_to_build.html">How to Build Zeppelin</a></li>
                <li role="separator" class="divider"></li>
                <li class="title"><span>Deployment</span></li>
                <li><a href="/setup/deployment/yarn_install.html">Submarine on Yarn</a></li>
                <li><a href="/setup/deployment/docker.html">Submarine on Docker</a></li>
                <li role="separator" class="divider"></li>
                <li class="title"><span>Operation</span></li>
                <li><a href="/setup/operation/configuration.html">Configuration</a></li>
                <li><a href="/setup/operation/proxy_setting.html">Proxy Setting</a></li>
                <li><a href="/setup/operation/upgrading.html">Upgrading</a></li>
                <li><a href="/setup/operation/trouble_shooting.html">Trouble Shooting</a></li>
              </ul>
            </li>

            <li>
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">Ecosystem <b class="caret"></b></a>
              <ul class="dropdown-menu scrollable-menu">
                <li class="title"><span>Ecosystem</span></li>
                <li><a href="/usage/ecosystem/overview.html">Overview</a></li>
                <li role="separator" class="divider"></li>
                <li><a href="/ecosystem/zeppelin.html">Zeppelin</a></li>
                <li><a href="/ecosystem/jdbc.html">JDBC</a></li>
                <li><a href="/ecosystem/python.html">Python</a></li>
              </ul>
            </li>
            <li>
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">More<b class="caret"></b></a>
              <ul class="dropdown-menu scrollable-menu" style="right: 0; left: auto;">
                <li class="title"><span>Extending Submarine</span></li>
                <li><a href="/development/writing_zeppelin_interpreter.html">Writing Submarine Interpreter</a></li>
                <li role="separator" class="divider"></li>
                <li class="title"><span>Contributing to Zeppelin</span></li>
                <li><a href="/setup/basics/how_to_build.html">How to Build Zeppelin</a></li>
                <li><a href="/development/contribution/useful_developer_tools.html">Useful Developer Tools</a></li>
                <li><a href="/development/contribution/how_to_contribute_code.html">How to Contribute (code)</a></li>
                <li><a href="/development/contribution/how_to_contribute_website.html">How to Contribute (website)</a></li>
                <li role="separator" class="divider"></li>
                <li class="title"><span>External Resources</span></li>
                <li><a target="_blank" href="">Mailing List</a></li>
                <li><a target="_blank" href="">Apache Submarine Wiki</a></li>
                <li><a target="_blank" href="">Stackoverflow Questions about Zeppelin</a></li>
              </ul>
            </li>
            <li>
              <a href="/search.html" class="nav-search-link">
                <span class="fa fa-search nav-search-icon"></span>
              </a>
            </li>
          </ul>
        </nav><!--/.navbar-collapse -->
      </div>
    </div>



    <div class="content">
      
<!--<div class="hero-unit Install">
  <h1></h1>
</div>
-->

<div class="row">
  <div class="col-md-12">
    <!--
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<h1>Submarine Quick Start Guide</h1>

<h2>Prerequisite</h2>

<p>Must:</p>

<ul>
<li>Apache Hadoop version newer than 2.7.3</li>
</ul>

<p>Optional:</p>

<ul>
<li><a href="https://hadoop.apache.org/docs/r3.1.0/hadoop-yarn/hadoop-yarn-site/yarn-service/Overview.html">Enable YARN Service</a></li>
<li><a href="https://hadoop.apache.org/docs/r3.1.0/hadoop-yarn/hadoop-yarn-site/UsingGpus.html">Enable GPU on YARN</a></li>
<li><a href="https://hadoop.apache.org/docs/r3.1.1/hadoop-yarn/hadoop-yarn-site/DockerContainers.html">Enable Docker on YARN</a></li>
<li><a href="docs/0.2.0/WriteDockerfileTF">Build Docker images</a></li>
</ul>

<h2>Submarine Configuration</h2>

<p>After submarine 0.2.0, it supports two runtimes which are YARN service
 runtime and Linkedin&#39;s TonY runtime for YARN. Each runtime can support both
 Tensorflow and PyTorch framework. But we don&#39;t need to worry about the
  usage because the two runtime implements the same interface.</p>

<p>So before we start running a job, the runtime type should be picked. The
runtime choice may vary depending on different requirements. Check below
table to choose your runtime.</p>

<p>Note that if you want to quickly try Submarine on new or existing YARN cluster, use TonY runtime will help you get start easier(0.2.0+)</p>

<table><thead>
<tr>
<th>Hadoop (YARN) Version</th>
<th>Is Docker Enabled</th>
<th>Is GPU Enabled</th>
<th>Acceptable Runtime</th>
</tr>
</thead><tbody>
<tr>
<td>2.7.3 ~ 3.0.X</td>
<td>X</td>
<td>X</td>
<td>TonY</td>
</tr>
<tr>
<td>3.1.0+</td>
<td>X</td>
<td>X</td>
<td>TonY</td>
</tr>
<tr>
<td>3.1.0+</td>
<td>X</td>
<td>√</td>
<td>TonY</td>
</tr>
<tr>
<td>3.1.0+</td>
<td>√</td>
<td>X</td>
<td>TonY/YARN-Service</td>
</tr>
<tr>
<td>3.1.0+</td>
<td>√</td>
<td>√</td>
<td>TonY/YARN-Service</td>
</tr>
</tbody></table>

<p>For the environment setup, please check <a href="docs/0.2.0/InstallationGuide">InstallationGuide</a> or <a href="docs/0.2.0/InstallationGuideChineseVersion">InstallationGuideCN</a></p>

<p>Once the applicable runtime is chosen and environment is ready, a <code>submarine.xml</code> need to be created under
 <code>$HADOOP_CONF_DIR</code>. To use the TonY runtime, please set below value in the
 submarine configuration.</p>

<table><thead>
<tr>
<th align="left">Configuration Name</th>
<th align="left">Description</th>
</tr>
</thead><tbody>
<tr>
<td align="left"><code>submarine.runtime.class</code></td>
<td align="left">&quot;org.apache.hadoop.yarn.submarine.runtimes.tony.TonyRuntimeFactory&quot; or &quot;org.apache.hadoop.yarn.submarine.runtimes.yarnservice.YarnServiceRuntimeFactory&quot;</td>
</tr>
</tbody></table>

<p>A sample <code>submarine.xml</code> is here:</p>
<div class="highlight"><pre><code class="java language-java" data-lang="java"><span class="o">&lt;?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s">&quot;1.0&quot;</span><span class="o">?&gt;</span>
<span class="o">&lt;</span><span class="n">configuration</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">property</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">submarine</span><span class="o">.</span><span class="na">runtime</span><span class="o">.</span><span class="na">class</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">hadoop</span><span class="o">.</span><span class="na">yarn</span><span class="o">.</span><span class="na">submarine</span><span class="o">.</span><span class="na">runtimes</span><span class="o">.</span><span class="na">tony</span><span class="o">.</span><span class="na">TonyRuntimeFactory</span><span class="o">&lt;/</span><span class="n">value</span><span class="o">&gt;</span>
    <span class="o">&lt;!--</span> <span class="n">Alternatively</span><span class="o">,</span> <span class="n">you</span> <span class="n">can</span> <span class="nl">use:</span>
    <span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">hadoop</span><span class="o">.</span><span class="na">yarn</span><span class="o">.</span><span class="na">submarine</span><span class="o">.</span><span class="na">runtimes</span><span class="o">.</span><span class="na">yarnservice</span><span class="o">.</span><span class="na">YarnServiceRuntimeFactory</span><span class="o">&lt;/</span><span class="n">value</span><span class="o">&gt;</span>
    <span class="o">--&gt;</span>
  <span class="o">&lt;/</span><span class="n">property</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">configuration</span><span class="o">&gt;</span>
</code></pre></div>
<p>For more Submarine configuration:</p>

<table><thead>
<tr>
<th align="left">Configuration Name</th>
<th align="left">Description</th>
</tr>
</thead><tbody>
<tr>
<td align="left"><code>submarine.localization.max-allowed-file-size-mb</code></td>
<td align="left">Optional. This sets a size limit to the file/directory to be localized in &quot;-localization&quot; CLI option. 2GB by default.</td>
</tr>
</tbody></table>

<h2>Launch Training Job</h2>

<p>This section will give us an idea of how the submarine CLI looks like.</p>

<p>Although the run job command looks simple, different job may have very different parameters.</p>

<p>For a quick try on Mnist example with TonY runtime, check <a href="docs/0.2.0/TonYRuntimeGuide">TonY Mnist Example</a></p>

<p>For a quick try on Cifar10 example with YARN native service runtime, check <a href="docs/0.2.0/RunningDistributedCifar10TFJobs">YARN Service Cifar10 Example</a></p>

<h2>Get job history / logs</h2>

<h3>Get Job Status from CLI</h3>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash"><span class="nv">CLASSPATH</span><span class="o">=</span>path-to/hadoop-conf:path-to/hadoop-submarine-all-<span class="k">${</span><span class="nv">SUBMARINE_VERSION</span><span class="k">}</span>-hadoop-<span class="k">${</span><span class="nv">HADOOP_VERSION</span><span class="k">}</span>.jar <span class="se">\</span>
java org.apache.hadoop.yarn.submarine.client.cli.Cli <span class="se">\</span>
job show --name tf-job-001
</code></pre></div>
<p>Output looks like:</p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash">Job Meta Info:
  Application Id: application_1532131617202_0005
  Input Path: hdfs://default/dataset/cifar-10-data
  Checkpoint Path: hdfs://default/tmp/cifar-10-jobdir
  Run Parameters: --name tf-job-001 --docker_image &lt;your-docker-image&gt;
                  <span class="o">(</span>... all your commandline before run the job<span class="o">)</span>
</code></pre></div>
<p>After that, you can run <code>tensorboard --logdir=&lt;checkpoint-path&gt;</code> to view Tensorboard of the job.</p>

<h3>Get component logs from a training job</h3>

<p>We can use <code>yarn logs -applicationId &lt;applicationId&gt;</code> to get logs from CLI.
Or from YARN UI:</p>

<p><img src="/assets/themes/submarine/img/job-logs-ui.png" alt="alt text" title="Job logs UI"></p>

<h2>Submarine Commandline options</h2>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash">usage: ... job run

 -framework &lt;arg&gt;             Framework to use.
                              Valid values are: tensorflow, pytorch.
                              The default framework is Tensorflow.
 -checkpoint_path &lt;arg&gt;       Training output directory of the job, could
                              be <span class="nb">local </span>or other FS directory. This
                              typically includes checkpoint files and
                              exported model
 -docker_image &lt;arg&gt;          Docker image name/tag
 -env &lt;arg&gt;                   Common environment variable of worker/ps
 -input_path &lt;arg&gt;            Input of the job, could be <span class="nb">local </span>or other FS
                              directory
 -name &lt;arg&gt;                  Name of the job
 -num_ps &lt;arg&gt;                Number of PS tasks of the job, by default
                              it is 0
 -num_workers &lt;arg&gt;           Numnber of worker tasks of the job, by
                              default it is 1
 -ps_docker_image &lt;arg&gt;       Specify docker image <span class="k">for </span>PS, when this is
                              not specified, PS uses --docker_image as
                              default.
 -ps_launch_cmd &lt;arg&gt;         Commandline of worker, arguments will be
                              directly used to launch the PS
 -ps_resources &lt;arg&gt;          Resource of each PS, <span class="k">for </span>example
                              memory-mb<span class="o">=</span>2048,vcores<span class="o">=</span>2,yarn.io/gpu<span class="o">=</span>2
 -queue &lt;arg&gt;                 Name of queue to run the job, by default it
                              uses default queue
 -saved_model_path &lt;arg&gt;      Model exported path <span class="o">(</span>savedmodel<span class="o">)</span> of the job,
                              which is needed when exported model is not
                              placed under <span class="k">${</span><span class="nv">checkpoint_path</span><span class="k">}</span>could be
                              <span class="nb">local </span>or other FS directory. This will be
                              used to serve.
 -tensorboard &lt;arg&gt;           Should we run TensorBoard <span class="k">for </span>this job? By
                              default it is <span class="nb">true</span>
 -verbose                     Print verbose log <span class="k">for </span>troubleshooting
 -wait_job_finish             Specified when user want to <span class="nb">wait </span>the job
                              finish
 -worker_docker_image &lt;arg&gt;   Specify docker image <span class="k">for </span>WORKER, when this
                              is not specified, WORKER uses --docker_image
                              as default.
 -worker_launch_cmd &lt;arg&gt;     Commandline of worker, arguments will be
                              directly used to launch the worker
 -worker_resources &lt;arg&gt;      Resource of each worker, <span class="k">for </span>example
                              memory-mb<span class="o">=</span>2048,vcores<span class="o">=</span>2,yarn.io/gpu<span class="o">=</span>2
 -localization &lt;arg&gt;          Specify localization to remote/local
                              file/directory available to all container<span class="o">(</span>Docker<span class="o">)</span>.
                              Argument format is <span class="s2">&quot;RemoteUri:LocalFilePath[:rw]&quot;</span>
                              <span class="o">(</span>ro permission is not supported yet<span class="o">)</span>.
                              The RemoteUri can be a file or directory in <span class="nb">local</span>
<span class="nb">                              </span>or HDFS or s3 or abfs or http .etc.
                              The LocalFilePath can be absolute or relative.
                              If relative, it<span class="s1">&#39;ll be under container&#39;</span>s implied
                              working directory.
                              This option can be <span class="nb">set </span>mutiple times.
                              Examples are
                              -localization <span class="s2">&quot;hdfs:///user/yarn/mydir2:/opt/data&quot;</span>
                              -localization <span class="s2">&quot;s3a:///a/b/myfile1:./&quot;</span>
                              -localization <span class="s2">&quot;https:///a/b/myfile2:./myfile&quot;</span>
                              -localization <span class="s2">&quot;/user/yarn/mydir3:/opt/mydir3&quot;</span>
                              -localization <span class="s2">&quot;./mydir1:.&quot;</span>
 -conf &lt;arg&gt;                  User specified configuration, as
                              <span class="nv">key</span><span class="o">=</span>val pairs.
</code></pre></div>
<h4>Notes:</h4>

<p>When using <code>localization</code> option to make a collection of dependency Python
scripts available to entry python script in the container, you may also need to
set <code>PYTHONPATH</code> environment variable as below to avoid module import error
reported from <code>entry_script.py</code>.</p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash">... job run
  <span class="c"># the entry point</span>
  --localization entry_script.py:&lt;path&gt;/entry_script.py
  <span class="c"># the dependency Python scripts of the entry point</span>
  --localization other_scripts_dir:&lt;path&gt;/other_scripts_dir
  <span class="c"># the PYTHONPATH env to make dependency available to entry script</span>
  --env <span class="nv">PYTHONPATH</span><span class="o">=</span><span class="s2">&quot;&lt;path&gt;/other_scripts_dir&quot;</span>
  --worker_launch_cmd <span class="s2">&quot;python &lt;path&gt;/entry_script.py ...&quot;</span>
</code></pre></div>
<h2>Build From Source</h2>

<p>If you want to build the Submarine project by yourself, you can follow it <a href="docs/0.2.0/BuildFromCode">here</a></p>

  </div>
</div>


      <hr>
      <footer>
        <!-- <p>&copy; 2019 The Apache Software Foundation</p>-->
      </footer>
    </div>

    
  </body>
</html>

