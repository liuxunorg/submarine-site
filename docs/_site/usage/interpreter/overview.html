
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Apache Submarine 0.3.0 Documentation: Interpreter in Apache Submarine</title>
    <meta name="description" content="This document explains about the role of interpreters, interpreters group and interpreter settings in Apache Submarine. The concept of Zeppelin interpreter allows any language/data-processing-backend to be plugged into Zeppelin.">
    <meta name="author" content="The Apache Software Foundation">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- Le styles -->
    <link href="/assets/themes/submarine/bootstrap/css/bootstrap.css" rel="stylesheet">
    <link href="/assets/themes/submarine/css/style.css?body=1" rel="stylesheet" type="text/css">
    <link href="/assets/themes/submarine/css/syntax.css" rel="stylesheet"  type="text/css" media="screen" /> 
    <!-- Le fav and touch icons -->
    <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->

    <!-- Js -->
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="/assets/themes/submarine/bootstrap/js/bootstrap.min.js"></script>
    <script src="/assets/themes/submarine/js/docs.js"></script>
    <script src="/assets/themes/submarine/js/anchor.min.js"></script>
    <script src="/assets/themes/submarine/js/toc.js"></script>
    <script src="/assets/themes/submarine/js/lunr.min.js"></script>
    <script src="/assets/themes/submarine/js/search.js"></script>    

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">
  </head>

  <body>
    
        <div id="menu" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container navbar-container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <div class="navbar-brand">
            <a class="navbar-brand-main" href="http://submarine.apache.org">
              <img src="/assets/themes/submarine/img/submarine_white_logo.png" width="85"
                   style="margin-top: -2px;" alt="Apache Submarine">
              <span style="margin-left: 5px; font-size: 27px;">Submarine</span>
              <a class="navbar-brand-version" href=""
                 style="font-size: 15px; color: white;"> 0.3.0
              </a>
            </a>
          </div>
        </div>
        <nav class="navbar-collapse collapse" role="navigation">
          <ul class="nav navbar-nav">
            <li>
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">Quick Start <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li class="title"><span>Getting Started</span></li>
                <li><a href="/quickstart/index.html">Quick Start Guide</a></li>
                <li><a href="/quickstart/install.html">Install Submarine</a></li>
                <li role="separator" class="divider"></li>
                <li><a href="/quickstart/tensorflow_with_submarine.html">Tensorflow with Submarine</a></li>
                <li><a href="/quickstart/pytorch_with_submarine.html">PyTorch with Submarine</a></li>
              </ul>
            </li>

            <li>
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">Usage<b class="caret"></b></a>
              <ul class="dropdown-menu scrollable-menu">
                <li class="title"><span>Interpreter</span></li>
                <li><a href="/usage/interpreter/overview.html">Overview</a></li>
                <li><a href="/usage/interpreter/interpreter_binding_mode.html">Interpreter Binding Mode</a></li>
                <li><a href="/usage/interpreter/user_impersonation.html">User Impersonation</a></li>
                <li role="separator" class="divider"></li>
                <li class="title"><span>REST API</span></li>
                <li><a href="/usage/rest_api/submarine_server.html">Submarine Server API</a></li>
                <li><a href="/usage/rest_api/configuration.html">Configuration API</a></li>
                <li role="separator" class="divider"></li>
                <li class="title"><span>Other Features</span></li>
                <li><a href="/usage/other_features/publishing_paragraphs.html">Publishing Paragraphs</a></li>
                <li><a href="/usage/other_features/personalized_mode.html">Personalized Mode</a></li>
                <li><a href="/usage/other_features/customizing_homepage.html">Customizing Zeppelin Homepage</a></li>
              </ul>
            </li>

            <li>
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">Setup<b class="caret"></b></a>
              <ul class="dropdown-menu scrollable-menu">
                <li class="title"><span>Basics</span></li>
                <li><a href="/setup/basics/how_to_build.html">How to Build Zeppelin</a></li>
                <li role="separator" class="divider"></li>
                <li class="title"><span>Deployment</span></li>
                <li><a href="/setup/deployment/yarn_install.html">Submarine on Yarn</a></li>
                <li><a href="/setup/deployment/docker.html">Submarine on Docker</a></li>
                <li role="separator" class="divider"></li>
                <li class="title"><span>Operation</span></li>
                <li><a href="/setup/operation/configuration.html">Configuration</a></li>
                <li><a href="/setup/operation/proxy_setting.html">Proxy Setting</a></li>
                <li><a href="/setup/operation/upgrading.html">Upgrading</a></li>
                <li><a href="/setup/operation/trouble_shooting.html">Trouble Shooting</a></li>
              </ul>
            </li>

            <li>
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">Ecosystem <b class="caret"></b></a>
              <ul class="dropdown-menu scrollable-menu">
                <li class="title"><span>Ecosystem</span></li>
                <li><a href="/usage/ecosystem/overview.html">Overview</a></li>
                <li role="separator" class="divider"></li>
                <li><a href="/ecosystem/zeppelin.html">Zeppelin</a></li>
                <li><a href="/ecosystem/jdbc.html">JDBC</a></li>
                <li><a href="/ecosystem/python.html">Python</a></li>
              </ul>
            </li>
            <li>
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">More<b class="caret"></b></a>
              <ul class="dropdown-menu scrollable-menu" style="right: 0; left: auto;">
                <li class="title"><span>Extending Submarine</span></li>
                <li><a href="/development/writing_zeppelin_interpreter.html">Writing Submarine Interpreter</a></li>
                <li role="separator" class="divider"></li>
                <li class="title"><span>Contributing to Zeppelin</span></li>
                <li><a href="/setup/basics/how_to_build.html">How to Build Zeppelin</a></li>
                <li><a href="/development/contribution/useful_developer_tools.html">Useful Developer Tools</a></li>
                <li><a href="/development/contribution/how_to_contribute_code.html">How to Contribute (code)</a></li>
                <li><a href="/development/contribution/how_to_contribute_website.html">How to Contribute (website)</a></li>
                <li role="separator" class="divider"></li>
                <li class="title"><span>External Resources</span></li>
                <li><a target="_blank" href="">Mailing List</a></li>
                <li><a target="_blank" href="">Apache Submarine Wiki</a></li>
                <li><a target="_blank" href="">Stackoverflow Questions about Zeppelin</a></li>
              </ul>
            </li>
            <li>
              <a href="/search.html" class="nav-search-link">
                <span class="fa fa-search nav-search-icon"></span>
              </a>
            </li>
          </ul>
        </nav><!--/.navbar-collapse -->
      </div>
    </div>



    <div class="content">
      
<!--<div class="hero-unit Interpreter in Apache Submarine">
  <h1></h1>
</div>
-->

<div class="row">
  <div class="col-md-12">
    <!--
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<h1>Interpreter in Apache Submarine</h1>

<div id="toc"></div>

<h2>Overview</h2>

<p>In this section, we will explain about the role of interpreters, interpreters group and interpreter settings in Zeppelin.
The concept of Zeppelin interpreter allows any language/data-processing-backend to be plugged into Zeppelin.
Currently, Zeppelin supports many interpreters such as Scala ( with Apache Spark ), Python ( with Apache Spark ), Spark SQL, JDBC, Markdown, Shell and so on.</p>

<h2>What is Zeppelin interpreter?</h2>

<p>Zeppelin Interpreter is a plug-in which enables Zeppelin users to use a specific language/data-processing-backend. For example, to use Scala code in Zeppelin, you need <code>%spark</code> interpreter.</p>

<p>When you click the <code>+Create</code> button in the interpreter page, the interpreter drop-down list box will show all the available interpreters on your server.</p>

<p><img src="/assets/themes/submarine/img/screenshots/interpreter_create.png" width="280px"></p>

<h2>What is interpreter setting?</h2>

<p>Zeppelin interpreter setting is the configuration of a given interpreter on Zeppelin server. For example, the properties are required for hive JDBC interpreter to connect to the Hive server.</p>

<p><img src="/assets/themes/submarine/img/screenshots/interpreter_setting.png" width="500px"></p>

<p>Properties are exported as environment variables when property name is consisted of upper characters, numbers and underscore ([A-Z_0-9]). Otherwise set properties as JVM property. </p>

<p>You may use parameters from the context of interpreter by add #{contextParameterName} in value, parameter can be of the following types: string, number, boolean.</p>

<h6>Context parameters</h6>

<table class="table-configuration">
  <tr>
    <th>Name</th>
    <th>Type</th>
  </tr>
  <tr>
    <td>user</td>
    <td>string</td>
  </tr>
  <tr>
    <td>noteId</td>
    <td>string</td>
  </tr>
  <tr>
    <td>replName</td>
    <td>string</td>
  </tr>
  <tr>
    <td>className</td>
    <td>string</td>
  </tr>
</table>

<p>If context parameter is null then replaced by empty string.</p>

<p><img src="/assets/themes/submarine/img/screenshots/interpreter_setting_with_context_parameters.png" width="800px"></p>

<p><br>
Each notebook can be bound to multiple Interpreter Settings using setting icon on upper right corner of the notebook.</p>

<p><img src="/assets/themes/submarine/img/screenshots/interpreter_binding.png" width="800px"></p>

<h2>What is interpreter group?</h2>

<p>Every Interpreter is belonged to an <strong>Interpreter Group</strong>. Interpreter Group is a unit of start/stop interpreter.
By default, every interpreter is belonged to a single group, but the group might contain more interpreters. For example, Spark interpreter group is including Spark support, pySpark, Spark SQL and the dependency loader.</p>

<p>Technically, Zeppelin interpreters from the same group are running in the same JVM. For more information about this, please checkout <a href="../development/writing_zeppelin_interpreter.html">here</a>.</p>

<p>Each interpreters is belonged to a single group and registered together. All of their properties are listed in the interpreter setting like below image.</p>

<p><img src="/assets/themes/submarine/img/screenshots/interpreter_setting_spark.png" width="500px"></p>

<h2>Interpreter binding mode</h2>

<p>Each Interpreter Setting can choose one of &#39;shared&#39;, &#39;scoped&#39;, &#39;isolated&#39; interpreter binding mode.
In &#39;shared&#39; mode, every notebook bound to the Interpreter Setting will share the single Interpreter instance. In &#39;scoped&#39; mode, each notebook will create new Interpreter instance in the same interpreter process. In &#39;isolated&#39; mode, each notebook will create new Interpreter process.</p>

<p>For more information, check <a href="./interpreter_binding_mode.html">Interpreter Binding Mode</a>.</p>

<p><img src="/assets/themes/submarine/img/screenshots/interpreter_persession.png" width="400px"></p>

<h2>Connecting to the existing remote interpreter</h2>

<p>Zeppelin users can start interpreter thread embedded in their service. This will provide flexibility to user to start interpreter on remote host. To start interpreter along with your service you have to create an instance of <code>RemoteInterpreterServer</code> and start it as follows:</p>
<div class="highlight"><pre><code class="java language-java" data-lang="java"><span class="n">RemoteInterpreterServer</span> <span class="n">interpreter</span><span class="o">=</span><span class="k">new</span> <span class="n">RemoteInterpreterServer</span><span class="o">(</span><span class="mi">3678</span><span class="o">);</span> 
<span class="c1">// Here, 3678 is the port on which interpreter will listen.    </span>
<span class="n">interpreter</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</code></pre></div>
<p>The above code will start interpreter thread inside your process. Once the interpreter is started you can configure zeppelin to connect to RemoteInterpreter by checking <strong>Connect to existing process</strong> checkbox and then provide <strong>Host</strong> and <strong>Port</strong> on which interpreter process is listening as shown in the image below:</p>

<p><img src="/assets/themes/submarine/img/screenshots/existing_interpreter.png" width="450px"></p>

<h2>Precode</h2>

<p>Snippet of code (language of interpreter) that executes after initialization of the interpreter depends on <a href="#interpreter-binding-mode">Binding mode</a>. To configure add parameter with class of interpreter (<code>zeppelin.&lt;ClassName&gt;.precode</code>) except JDBCInterpreter (<a href="../../interpreter/jdbc.html#usage-precode">JDBC precode</a>). </p>

<p><img src="/assets/themes/submarine/img/screenshots/interpreter_precode.png" width="800px"></p>

<h2>Interpreter Lifecycle Management</h2>

<p>Before 0.8.0, Zeppelin don&#39;t have lifecycle management on interpreter. User have to shutdown interpreters explicitly via UI. Starting from 0.8.0, Zeppelin provides a new interface
<code>LifecycleManager</code> to control the lifecycle of interpreters. For now, there&#39;re 2 implementations: <code>NullLifecycleManager</code> and <code>TimeoutLifecycleManager</code> which is default. </p>

<p><code>NullLifecycleManager</code> will do nothing,
user need to control the lifecycle of interpreter by themselves as before. <code>TimeoutLifecycleManager</code> will shutdown interpreters after interpreter idle for a while. By default, the idle threshold is 1 hour.
User can change it via <code>zeppelin.interpreter.lifecyclemanager.timeout.threshold</code>. <code>TimeoutLifecycleManager</code> is the default lifecycle manager, user can change it via <code>zeppelin.interpreter.lifecyclemanager.class</code>.</p>

<h2>Generic ConfInterpreter</h2>

<p>Zeppelin&#39;s interpreter setting is shared by all users and notes, if you want to have different setting you have to create new interpreter, e.g. you can create <code>spark_jar1</code> for running spark with dependency jar1 and <code>spark_jar2</code> for running spark with dependency jar2.
This approach works, but not so convenient. <code>ConfInterpreter</code> can provide more fine-grained control on interpreter setting and more flexibility. </p>

<p><code>ConfInterpreter</code> is a generic interpreter that could be used by any interpreters. The input format should be property file format.
It can be used to make custom setting for any interpreter. But it requires to run before interpreter process launched. And when interpreter process is launched is determined by interpreter mode setting.
So users needs to understand the (<a href="../usage/interpreter/interpreter_bindings_mode.html">interpreter mode setting </a> of Zeppelin and be aware when interpreter process is launched. E.g. If we set spark interpreter setting as isolated per note. Under this setting, each note will launch one interpreter process. 
In this scenario, user need to put <code>ConfInterpreter</code> as the first paragraph as the below example. Otherwise the customized setting can not be applied (Actually it would report ERROR)
<img src="/assets/themes/submarine/img/screenshots/conf_interpreter.png" width="500px"></p>

<h2>Interpreter Process Recovery</h2>

<p>Before 0.8.0, shutting down Zeppelin also mean to shutdown all the running interpreter processes. Usually admin will shutdown Zeppelin server for maintenance or upgrade, but don&#39;t want to shut down the running interpreter processes.
In such cases, interpreter process recovery is necessary. Starting from 0.8.0, user can enable interpreter process recovering via setting <code>zeppelin.recovery.storage.class</code> as 
<code>org.apache.zeppelin.interpreter.recovery.FileSystemRecoveryStorage</code> or other implementations if available in future, by default it is <code>org.apache.zeppelin.interpreter.recovery.NullRecoveryStorage</code>
 which means recovery is not enabled. Enable recover means shutting down Zeppelin would not terminating interpreter process,
and when Zeppelin is restarted, it would try to reconnect to the existing running interpreter processes. If you want to kill all the interpreter processes after terminating Zeppelin even when recovery is enabled, you can run <code>bin/stop-interpreter.sh</code> </p>

  </div>
</div>


      <hr>
      <footer>
        <!-- <p>&copy; 2019 The Apache Software Foundation</p>-->
      </footer>
    </div>

    
  </body>
</html>

